---
// src/components/common/CookieConsent.astro
---

<link rel="stylesheet" href="/libs/cookieconsent.css" />
<link rel="stylesheet" href="/libs/cookie-custom.css" />

<script is:inline src="/libs/cookieconsent.umd.js"></script>

<script is:inline>
async function initCookieBanner() {

  if (!window.CookieConsent) {
    setTimeout(initCookieBanner, 100);
    return;
  }

  try {
    const { config } = await import('/libs/cookieconsent-config.js');

    // UI neu rendern, Zustimmung behalten
    window.CookieConsent.reset(false);

    // ðŸ‘‰ WICHTIG: KEIN root mehr Ã¼bergeben
    window.CookieConsent.run({
      ...config
    });

    window.CC = window.CookieConsent;

  } catch (e) {
    console.error('CookieConsent Start-Fehler:', e);
  }
}

// Sprache sofort als Cookie setzen (View-Transition-safe)
document.body.addEventListener('click', (event) => {
  const link = event.target.closest('[data-lang]');
  if (!link || !link.dataset.lang) return;

  const lang = link.dataset.lang;

  document.cookie =
    "preferred_language=" + lang +
    "; path=/; max-age=" + (60*60*24*365) +
    "; SameSite=Lax";
});

// Astro Navigation
document.addEventListener('astro:page-load', initCookieBanner);

// Erster Seitenaufruf
if (document.readyState === 'complete' || document.readyState === 'interactive') {
  initCookieBanner();
} else {
  document.addEventListener('DOMContentLoaded', initCookieBanner);
}
</script>