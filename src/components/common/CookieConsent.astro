---
// src/components/common/CookieConsent.astro
---

<!-- Banner Container persistent -->
<div id="cookie-consent-root"></div>

<!-- Styles -->
<link rel="stylesheet" href="/libs/cookieconsent.css" />
<link rel="stylesheet" href="/libs/cookie-custom.css" />

<script type="module">
  function initCookieBanner() {
    const root = document.getElementById('cookie-consent-root');
    if (!root || !window.CookieConsent) {
      setTimeout(initCookieBanner, 50); // warten bis Library geladen
      return;
    }

    if (!window.__CookieConsentInitialized) {
      import('/libs/cookieconsent-config.js').then(({ config }) => {
        window.CookieConsent.run({ ...config, container: root });
        window.__CookieConsentInitialized = true;
      });
    } else {
      // Bei Seitenwechsel: resetten und rerun
      import('/libs/cookieconsent-config.js').then(({ config }) => {
        window.CookieConsent.reset();
        window.CookieConsent.run({ ...config, container: root });
      });
    }
  }

  // Library dynamisch laden, falls nicht vorhanden
  if (!window.CookieConsent) {
    const script = document.createElement('script');
    script.src = '/libs/cookieconsent.umd.js';
    script.isInline = true;
    document.head.appendChild(script);
    script.onload = initCookieBanner;
  }

  document.addEventListener('DOMContentLoaded', initCookieBanner);
  document.addEventListener('astro:page-load', initCookieBanner);
</script>