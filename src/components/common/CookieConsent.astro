---
// src/components/common/CookieConsent.astro
// Alles intern gekapselt, kein Layout-Div nötig
---

<!-- Styles -->
<link rel="stylesheet" href="/libs/cookieconsent.css" />
<link rel="stylesheet" href="/libs/cookie-custom.css" />

<!-- Persistent Banner Container innerhalb der Komponente -->
<div id="cookie-consent-root"></div>

<script type="module">
  async function initCookieBanner() {
    const root = document.getElementById('cookie-consent-root');
    if (!root) return;

    // CookieConsent Library laden, falls nicht vorhanden
    if (!window.CookieConsent) {
      const script = document.createElement('script');
      script.src = '/libs/cookieconsent.umd.js';
      script.isInline = true;
      document.head.appendChild(script);
      script.onload = initCookieBanner;
      return;
    }

    // Config laden
    const { config } = await import('/libs/cookieconsent-config.js');

    // Wenn schon initialisiert -> reset + rerun (für SPA/astro:page-load)
    if (window.__CookieConsentInitialized) {
      window.CookieConsent.reset();
      window.CookieConsent.run({ ...config, container: root });
    } else {
      window.CookieConsent.run({ ...config, container: root });
      window.__CookieConsentInitialized = true;
    }
  }

  // Init bei normalem DOMContentLoaded + SPA Navigation
  document.addEventListener('DOMContentLoaded', initCookieBanner);
  document.addEventListener('astro:page-load', initCookieBanner);
</script>