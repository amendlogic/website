---
/* src/components/common/CookieConsent.astro */
---

<link rel="stylesheet" href="/libs/cookieconsent.css" />
<link rel="stylesheet" href="/libs/cookie-custom.css" />

<script is:inline src="/libs/cookieconsent.umd.js"></script>

<script is:inline>
async function initCookieBanner() {
  if (!window.CookieConsent) {
    setTimeout(initCookieBanner, 100);
    return;
  }

  try {
    const { config } = await import('/libs/cookieconsent-config.js');

    // ðŸ‘‰ Sprache kommt NUR aus <html lang="...">
    const currentLang =
      document.documentElement.lang?.split('-')[0] || 'de';

    window.CookieConsent.run({
      ...config,
      language: {
        ...config.language,
        current: currentLang
      }
    });

  } catch (e) {
    console.error("CookieConsent Fehler:", e);
  }
}

document.addEventListener('astro:page-load', initCookieBanner);
</script>

<script is:inline>
document.addEventListener("click", function (event) {
  const link = event.target.closest("[data-lang]");
  if (!link) return;

  event.preventDefault();

  const lang = link.dataset.lang;
  if (lang !== "de" && lang !== "en") return;

  const isProd = location.protocol === "https:";

  document.cookie =
    "preferred_language=" + lang +
    "; path=/; max-age=31536000; SameSite=Lax" +
    (isProd ? "; Secure" : "");

  const query = window.location.search || "";
  const hash = window.location.hash || "";

  window.location.href = "/" + lang + "/" + query + hash;
});
</script>