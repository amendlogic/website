---
import { UI } from 'astrowind:config';
---

<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  function applyTheme(theme) {
    const resolvedTheme = (theme === 'system') 
      ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') 
      : theme;
    
    document.documentElement.classList.toggle('dark', resolvedTheme === 'dark');

    const updateIcons = () => {
      const icons = document.querySelectorAll('[data-aw-theme-icon]');
      icons.forEach(icon => {
        icon.classList.toggle('hidden', icon.getAttribute('data-aw-theme-icon') !== theme);
      });
    };

    // Icons erst setzen, wenn der Browser Zeit hat (verhindert VerzÃ¶gerung beim Text-Rendering)
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', updateIcons);
    } else {
      (window.requestIdleCallback || ((cb) => setTimeout(cb, 1)))(updateIcons);
    }
  }

  const savedTheme = localStorage.getItem('theme') || (defaultTheme.endsWith(':only') ? defaultTheme.replace(':only', '') : 'system');
  applyTheme(savedTheme);
</script>
