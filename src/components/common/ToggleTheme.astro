---
import { Icon } from 'astro-icon/components';
import { UI } from 'astrowind:config';
---

<button 
  type="button" 
  class={className} 
  aria-label={label} 
  id="theme-toggler"
>
  <Icon name="tabler:sun" class={`${iconClass} sun-icon`} />
  <Icon name="tabler:moon" class={`${iconClass} moon-icon`} />
  <Icon name="tabler:device-desktop" class={`${iconClass} system-icon`} />
</button>

<style>
  /* Grundzustand: Alle Icons verstecken */
  .sun-icon, .moon-icon, .system-icon { display: none; }

  /* Zeige Sun-Icon wenn Theme explizit Light */
  :global(html[data-theme="light"]) .sun-icon { display: block; }
  
  /* Zeige Moon-Icon wenn Theme explizit Dark */
  :global(html[data-theme="dark"]) .moon-icon { display: block; }
  
  /* Zeige Monitor-Icon wenn System-Modus aktiv */
  :global(html[data-theme="system"]) .system-icon { display: block; }
</style>

<script>
  const setupToggle = () => {
    const btn = document.getElementById('theme-toggler');
    if (!btn) return;

    btn.addEventListener('click', () => {
      const current = localStorage.theme || 'system';
      let next;

      if (current === 'system') next = 'light';
      else if (current === 'light') next = 'dark';
      else next = 'system';

      if (next === 'system') {
        localStorage.removeItem('theme');
      } else {
        localStorage.theme = next;
      }

      // Die globale Funktion aufrufen - kein Reload nötig!
      if (window.applyTheme) {
        window.applyTheme(next);
      }
    });
  };

  // Initialisierung (auch für Astro View Transitions)
  setupToggle();
  document.addEventListener('astro:after-swap', setupToggle);
</script>