---
import { Icon } from 'astro-icon/components';
import { UI } from 'astrowind:config';

let theme = localStorage.getItem('theme') || UI.theme?.replace(':only','') || 'system';

function nextTheme() {
  const order = ['light','dark','system'];
  theme = order[(order.indexOf(theme)+1)%3];
  localStorage.setItem('theme', theme);
  applyTheme(theme);
}

function applyTheme(t) {
  document.documentElement.classList.remove('dark');
  if(t==='dark') document.documentElement.classList.add('dark');
  else if(t==='system' && window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark');
}

// reactive icon
$: iconName = theme==='light'?'tabler:sun':theme==='dark'?'tabler:moon':'tabler:device-desktop';
---

<button on:click={nextTheme} aria-label="Toggle Color Mode" class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center">
  <Icon name={iconName} class="w-6 h-6"/>
</button>