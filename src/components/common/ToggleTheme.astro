---
import { Icon } from 'astro-icon/components';
import { UI } from 'astrowind:config';
---

<button
  type="button"
  class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 
         focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 
         rounded-lg text-sm p-2.5 inline-flex items-center"
  aria-label="Toggle color mode"
  data-aw-toggle-color-scheme
  id="theme-toggle"
>
  <Icon name="tabler:sun" class="w-6 h-6" />
</button>

<script>
  const states = ["system", "light", "dark"];

  function getNext(state) {
    const i = states.indexOf(state);
    return states[(i + 1) % states.length];
  }

  function applyTheme(theme) {
    if (theme === "system") {
      document.documentElement.classList.remove("dark");
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        document.documentElement.classList.add("dark");
      }
    } else if (theme === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  }

  function updateIcon(theme) {
    const icon = document.querySelector("#theme-toggle svg");

    if (!icon) return;

    if (theme === "system") icon.setAttribute("name", "tabler:device-desktop");
    if (theme === "light") icon.setAttribute("name", "tabler:sun");
    if (theme === "dark") icon.setAttribute("name", "tabler:moon");
  }

  function toggleTheme() {
    const current = localStorage.getItem("theme") || "system";
    const next = getNext(current);

    localStorage.setItem("theme", next);
    applyTheme(next);
    updateIcon(next);
  }

  // Initial state
  const initial = localStorage.getItem("theme") || "system";
  applyTheme(initial);
  updateIcon(initial);

  document
    .querySelector("#theme-toggle")
    .addEventListener("click", toggleTheme);
</script>
