---
import { UI } from 'astrowind:config';
---
<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  const root = document.documentElement;

  function resolveTheme(theme) {
    if (theme === 'dark') return 'dark';
    if (theme === 'light') return 'light';
    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light';
  }

  function applyTheme(theme) {
    const resolved = resolveTheme(theme);
    root.classList.toggle('dark', resolved === 'dark');
  }

  function getInitialTheme() {
    if (localStorage.theme) return localStorage.theme;
    if (defaultTheme.endsWith(':only')) {
      return defaultTheme.replace(':only', '');
    }
    return defaultTheme;
  }

  const theme = getInitialTheme();
  localStorage.theme = theme;
  applyTheme(theme);

  // System-Theme live Ã¼bernehmen
  window
    .matchMedia('(prefers-color-scheme: dark)')
    .addEventListener('change', () => {
      if (localStorage.theme === 'system') {
        applyTheme('system');
      }
    });
</script>
