---
import { UI } from 'astrowind:config';
---

<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  if (typeof window !== 'undefined') {
    window.addEventListener('DOMContentLoaded', () => {
      const THEMES = ['system', 'light', 'dark'];

      // localStorage nur hier, im Browser
      function getStoredTheme() {
        try {
          return localStorage.getItem('theme') || 'system';
        } catch (e) {
          return 'system';
        }
      }

      function applyTheme(theme) {
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }

        // Buttons aktualisieren
        const btns = document.querySelectorAll('[data-aw-toggle-color-scheme]');
        btns.forEach((btn) => {
          const icon = btn.querySelector('svg');
          if (icon) icon.dataset.theme = theme;
        });
      }

      function initTheme() {
        let theme = getStoredTheme();

        if (theme === 'system') {
          theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        applyTheme(theme);
      }

      // initial beim Laden
      initTheme();

      // nach Astro-Seitenwechsel
      document.addEventListener('astro:after-swap', initTheme);
    });
  }
</script>