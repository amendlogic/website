---
import { UI } from 'astrowind:config';
---

<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  // Nur im Browser ausfÃ¼hren
  if (typeof window !== 'undefined') {
    // Warten bis DOM geladen ist
    window.addEventListener('DOMContentLoaded', () => {
      const THEMES = ['system', 'light', 'dark'];

      function getStoredTheme() {
        return localStorage.getItem('theme') || 'system';
      }

      function applyTheme(theme) {
        if (theme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');

        // Buttons ggf. aktualisieren
        const btns = document.querySelectorAll('[data-aw-toggle-color-scheme]');
        btns.forEach((btn) => {
          const icon = btn.querySelector('svg');
          if (!icon) return;
          icon.dataset.theme = theme;
        });
      }

      function initTheme() {
        let theme = getStoredTheme();

        if (theme === 'system') {
          theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        applyTheme(theme);
      }

      initTheme();

      // Nach Astro-Seitenwechsel erneut Theme setzen
      document.addEventListener('astro:after-swap', initTheme);
    });
  }
</script>