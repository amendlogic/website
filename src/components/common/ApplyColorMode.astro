---
import { UI } from 'astrowind:config';

// Temporary implementation
---
<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  if (window.__awColorModeInit) {
    return;
  }
  window.__awColorModeInit = true;

  const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

  function getSystemTheme() {
    return mediaQuery.matches ? 'dark' : 'light';
  }

  function applyTheme(theme) {
    document.documentElement.classList.toggle('dark', theme === 'dark');
  }

  // Initial apply
  if (sessionStorage.getItem('themeOverride')) {
    applyTheme(sessionStorage.getItem('themeOverride'));
  } else {
    applyTheme(getSystemTheme());
  }

  // Listen for system theme changes â†’ reset override
  mediaQuery.addEventListener('change', (e) => {
    sessionStorage.removeItem('themeOverride');
    applyTheme(e.matches ? 'dark' : 'light');
  });

  // Expose toggle globally
  window.toggleTheme = () => {
    const isDark = document.documentElement.classList.contains('dark');
    const nextTheme = isDark ? 'light' : 'dark';

    sessionStorage.setItem('themeOverride', nextTheme);
    applyTheme(nextTheme);
  };
</script>
