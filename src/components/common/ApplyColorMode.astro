---
import { UI } from 'astrowind:config';

// TODO: This code is temporary
---

<script is:inline>
  function applyTheme(theme) {
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function applyThemeFromSystem() {
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(systemDark ? 'dark' : 'light');
  }

  function setupSystemListener() {
    const media = window.matchMedia('(prefers-color-scheme: dark)');
    const handler = () => {
      localStorage.removeItem('themeOverride');
      applyThemeFromSystem();
    };

    if (media.addEventListener) {
      media.addEventListener('change', handler);
    } else if (media.addListener) {
      media.addListener(handler);
    }
  }

  function setupToggleButton() {
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-aw-toggle-color-scheme]');
      if (!btn) return;

      const isDark = document.documentElement.classList.contains('dark');
      const newTheme = isDark ? 'light' : 'dark';

      localStorage.setItem('themeOverride', newTheme);
      applyTheme(newTheme);
    });
  }

  // Initial load
  const override = localStorage.getItem('themeOverride');

  if (override) {
    applyTheme(override);
  } else {
    applyThemeFromSystem();
  }

  setupSystemListener();
  setupToggleButton();
</script>
