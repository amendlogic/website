---
import { UI } from 'astrowind:config';

// TODO: This code is temporary
---

<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  function applyTheme(theme) {
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function applyThemeFromSystem() {
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(systemDark ? 'dark' : 'light');
  }

  // 1) Prüfen ob ein Override existiert
  const override = localStorage.getItem('themeOverride');

  if (override) {
    applyTheme(override);
  } else {
    applyThemeFromSystem();
  }

  // 2) Systemwechsel überwachen → Override löschen
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    localStorage.removeItem('themeOverride');
    applyThemeFromSystem();
  });

  // 3) Toggle‑Button registrieren
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-aw-toggle-color-scheme]');
    if (!btn) return;

    const isDark = document.documentElement.classList.contains('dark');
    const newTheme = isDark ? 'light' : 'dark';

    // Override setzen
    localStorage.setItem('themeOverride', newTheme);
    applyTheme(newTheme);
  });
</script>
