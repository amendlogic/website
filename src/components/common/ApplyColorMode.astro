---
import { UI } from 'astrowind:config';
---
<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  const root = document.documentElement;

  function applyTheme(theme) {
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (theme === 'dark' || (theme === 'system' && systemDark)) {
      root.classList.add('dark');
    } else {
      root.classList.remove('dark');
    }

    // Icon-State aktualisieren
    document.querySelectorAll('[data-aw-theme-toggle]').forEach((btn) => {
      btn.dataset.theme = theme;
    });
  }

  function getInitialTheme() {
    if (localStorage.theme) return localStorage.theme;
    if (defaultTheme.endsWith(':only')) return defaultTheme.replace(':only', '');
    return defaultTheme;
  }

  const theme = getInitialTheme();
  applyTheme(theme);

  // System-Theme-Änderungen live übernehmen
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    if (localStorage.theme === 'system') {
      applyTheme('system');
    }
  });
</script>
