---
import { UI } from 'astrowind:config';
---

<script is:inline define:vars={{ defaultTheme: UI.theme || 'system' }}>
  function applyTheme(theme) {
    if (theme === 'system') {
      document.documentElement.classList.remove('dark');

      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
      }

    } else if (theme === 'dark') {
      document.documentElement.classList.add('dark');

    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  const saved = localStorage.getItem('theme');
  const theme = saved || defaultTheme || 'system';

  applyTheme(theme);

  if (theme === 'system') {
    window.matchMedia('(prefers-color-scheme: dark)')
      .addEventListener('change', () => applyTheme('system'));
  }
</script>
