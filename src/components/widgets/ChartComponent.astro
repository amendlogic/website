---
const {
  type = "line",
  labels = [],
  datasets = [],
  title = "",
} = Astro.props;

const chartId = `chart-${Math.random().toString(36).slice(2)}`;
---

<section class="w-full">
  {title && <h3 class="mb-2 font-semibold">{title}</h3>}
  <canvas id={chartId}></canvas>

  <script type="module" client:load>
    import {
      Chart,
      LineController,
      LineElement,
      PointElement,
      LinearScale,
      CategoryScale,
      BarController,
      BarElement,
      Tooltip,
      Legend
    } from "chart.js";

    Chart.register(
      LineController,
      LineElement,
      PointElement,
      LinearScale,
      CategoryScale,
      BarController,
      BarElement,
      Tooltip,
      Legend
    );

    const ctx = document.getElementById("{chartId}");

    new Chart(ctx, {
      type: "{type}",
      data: {
        labels: {JSON.stringify(labels)},
        datasets: {JSON.stringify(datasets)},
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
      },
    });
  </script>

  <style>
    canvas {
      max-height: 320px;
    }
  </style>
</section>