<script define:vars={{ chartId, chartData: JSON.stringify(chartData), chartOptions: JSON.stringify(chartOptions), chartType: type }}>
  // Debug-Helper: Loggt alles Wichtige in die Console
  console.log('ChartComponent script geladen für ID:', chartId);
  console.log('Chart-Typ:', chartType);
  console.log('Daten:', chartData);

  function initChart() {
    const canvas = document.getElementById(chartId);
    if (!canvas) {
      console.error('Canvas-Element nicht gefunden! ID:', chartId);
      return;
    }

    const ctx = canvas.getContext('2d');
    if (!ctx) {
      console.error('2D-Context konnte nicht erstellt werden');
      return;
    }

    if (!window.Chart) {
      console.error('window.Chart ist undefined – Chart.js hat nicht geladen!');
      return;
    }

    console.log('Chart.js ist verfügbar, erstelle Chart...');
    try {
      new window.Chart(ctx, {
        type: chartType,
        data: chartData,
        options: chartOptions,
      });
      console.log('Chart erfolgreich erstellt!');
    } catch (err) {
      console.error('Fehler beim Erstellen des Charts:', err);
    }
  }

  // Chart.js laden
  if (window.Chart) {
    console.log('Chart.js war schon geladen (global)');
    initChart();
  } else {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js';
    script.async = true;
    script.onload = () => {
      console.log('Chart.js UMD erfolgreich geladen via CDN');
      initChart();
    };
    script.onerror = () => {
      console.error('Fehler beim Laden von Chart.js CDN! Überprüfe Netzwerk/Console.');
    };
    document.head.appendChild(script);
  }
</script>