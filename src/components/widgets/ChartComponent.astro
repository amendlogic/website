<script client:load>
  // Warte auf DOM vollständig (sicherer)
  document.addEventListener('DOMContentLoaded', () => {
    initializeChart();
  });

  // Oder sofort versuchen + Fallback
  initializeChart();

  function initializeChart() {
    const container = document.currentScript?.previousElementSibling;
    if (!container) {
      console.error('Container-Div nicht gefunden');
      return;
    }

    const canvas = container.querySelector('canvas');
    if (!canvas) {
      console.error('Canvas nicht gefunden');
      return;
    }

    const chartId = 'chart-' + Math.random().toString(36).slice(2, 10); // einfach & unique
    canvas.id = chartId;

    console.log('ChartComponent startet – Canvas-ID:', chartId);

    function createChart() {
      const ctx = canvas.getContext('2d');
      if (!ctx) {
        console.error('Kein 2D-Context');
        return;
      }

      if (typeof window.Chart === 'undefined') {
        console.warn('Chart.js noch nicht da – warte...');
        return; // onload ruft es neu
      }

      console.log('Chart.js verfügbar → erstelle Chart');
      try {
        new window.Chart(ctx, {
          type: '{type}',
          data: {chartData},
          options: {chartOptions},
        });
        console.log('Chart erfolgreich gerendert!');
      } catch (err) {
        console.error('Chart-Erstellungsfehler:', err.message);
      }
    }

    if (window.Chart) {
      createChart();
    } else {
      console.log('Lade Chart.js...');
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js';
      script.async = true;
      script.onload = () => {
        console.log('Chart.js CDN geladen');
        createChart();
      };
      script.onerror = () => console.error('Chart.js CDN Laden fehlgeschlagen – Netzwerk/Adblocker?');
      document.head.appendChild(script);
    }
  }
</script>