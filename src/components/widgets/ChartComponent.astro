---
const { 
  title = "", 
  description = "", 
  type = "bar", 
  labels = [], 
  datasets = [] 
} = Astro.props;

// eindeutige ID für mehrere Charts
const chartId = `chart-${Math.random().toString(36).substring(2,9)}`;
---

<div class="bg-white p-6 rounded-lg shadow space-y-4">
  {title && <h2 class="text-xl font-bold">{title}</h2>}
  {description && <p class="text-gray-600">{description}</p>}
  <canvas id={chartId} class="w-full h-64"></canvas>
</div>

<script type="module" client:load>
  import { Chart, registerables } from 'https://cdn.jsdelivr.net/npm/chart.js/dist/chart.esm.js';
  Chart.register(...registerables);

  // Die Props müssen in echte JS-Objekte konvertiert werden
  const chartLabels = {labels};
  const chartDatasets = {datasets};

  const ctx = document.getElementById(chartId).getContext("2d");
  new Chart(ctx, {
    type: type,
    data: {
      labels: chartLabels,
      datasets: chartDatasets
    },
    options: { 
      responsive: true, 
      plugins: { legend: { position: "top" } } 
    }
  });
</script>