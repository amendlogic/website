---
// src/pages/index.astro
export const prerender = true;
---
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    
    <link rel="canonical" href="https://deine-domain.com/de/" />
    <meta name="robots" content="noindex" />

    <noscript>
        <meta http-equiv="refresh" content="0;url=/de/">
    </noscript>

    <script is:inline>
      try {
        var target = "de"; // Standard-Fallback

        // 1. Cookie prüfen (höchste Priorität)
        var m = document.cookie.match(/preferred_language=(en|de)/);
        if (m) {
          target = m[1];
        } 
        // 2. LocalStorage & Browser prüfen
        else {
          // LocalStorage lesen (falls vorhanden)
          var saved = null;
          try { saved = localStorage.getItem("lang"); } catch(e) {}

          var browser = navigator.language || navigator.userLanguage;

          if (saved && (saved === "de" || saved === "en")) {
            target = saved;
          } 
          else if (browser && String(browser).startsWith("en")) {
            target = "en";
          }
        }

        // 3. OPTIMIERUNG: Parameter und Hash behalten!
        // Wichtig für Marketing-Links (?utm_source=...) oder Anker (#section)
        var query = window.location.search || "";
        var hash = window.location.hash || "";

        window.location.replace("/" + target + "/" + query + hash);

      } catch (e) {
        // Sicherer Fallback, falls irgendwas im JS crasht
        window.location.replace("/de/");
      }
    </script>
</head>
<body>
</body>
</html>
