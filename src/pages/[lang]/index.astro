---
import { getI18nPaths, useTranslations } from '~/i18n/utils';
import { getFooterData } from '~/navigation';
import { getPermalink } from '~/utils/permalinks';

import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Note from '~/components/widgets/Note.astro';
import Content from '~/components/widgets/Content.astro';
import Steps from '~/components/widgets/Steps.astro';
import EChart from '~/components/widgets/EChart.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';

// 1️⃣ Static Paths
export async function getStaticPaths() {
  return getI18nPaths();
}

// 2️⃣ Sprache & Übersetzungen
const { lang } = Astro.params;
const t = useTranslations(lang); // intern fallback auf DEFAULT_LANG

// 3️⃣ FAQ Items mit exakter Reihenfolge
const faqOrderConfig = [
  { key: 'faq.performance.items', index: 0 },
  { key: 'faq.performance.items', index: 1 },
  { key: 'faq.performance.items', index: 2 },
  { key: 'faq.started.items', index: 0 },
  { key: 'faq.started.items', index: 1 },
  { key: 'faq.performance.items', index: 3 },
  { key: 'faq.security.items', index: 0 },
  { key: 'faq.billing.items', index: 0 },
  { key: 'faq.billing.items', index: 1 },
  { key: 'faq.support.items', index: 0 },
];

const selectedFAQItems = faqOrderConfig
  .map(({ key, index }) => {
    const items = t(key) || [];
    return items[index];
  })
  .filter(Boolean);

// 4️⃣ Metadata
const metadata = {
  title: `${t('index.hero.titleStart')} ${t('index.hero.titleAccent')} — AmendLogic`,
  ignoreTitleTemplate: true,
};

// 5️⃣ Footer Data
const footerData = getFooterData(lang, ['testimonials']);
---

<Layout metadata={metadata} footerData={footerData}>

  <Hero
    image={{ src: '~/assets/images/hero-image.png', alt: 'AstroWind Hero Image' }}
  >
    <Fragment slot="actions">
      <a href="https://github.com/arthelokyo/astrowind" target="_blank" class="btn btn-primary inline-flex items-center gap-2">
        {t('index.hero.btnPrimary')}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 1 59 59" class="w-9 h-9 ml-1 -mr-1.5 rtl:mr-1 rtl:-ml-1.5 inline-block">
          <path d="M33 17c-3.5 0-6.3 2.85-6.35 6.35 0 3.5 2.85 6.35 6.35 6.35s6.35-2.85 6.35-6.35S36.5 17 33 17ZM45.7 45.5 57.6 17H44.95L33.05 45.5H45.7Zm-22.25 0V17H1.3V28.1H12.4V45.5H23.5Z" fill="#FFFFFF"/>
        </svg>
      </a>
      <a href="#benefits" class="btn btn-secondary">
        {t('index.hero.btnSecondary')}
      </a>
    </Fragment>

    <Fragment slot="title" set:html={t('index.hero.text', {
      accent: `<span class="text-accent dark:text-white">${t('index.hero.accent')}</span>`,
    })} />

    <Fragment slot="subtitle">
      <span class="block mb-1 font-bold text-blue-600">{t('index.hero.tagline')}</span>
      {t('index.hero.subtitle')}
    </Fragment>
  </Hero>

  <Note 
    title={t('index.note.title')} 
    description={t('index.note.desc')} 
  />

  <Content
    isReversed
    id="benefits"
    tagline={t('index.features1.tagline')}
    title={t('index.features1.title')}
    items={t('index.features1.items')} 
    image={{
      src: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
      alt: 'Colorful Image',
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">
        {t('index.features1.contentTitle')}
      </h3>
      {t('index.features1.contentDesc')}
    </Fragment>
  </Content>

  <Content
    isAfterContent
    items={t('index.features2.items')}
    image={{
      src: 'https://images.unsplash.com/photo-1600132806370-bf17e65e942f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2194&q=80',
      alt: 'Blueprint Image',
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">
        {t('index.features2.contentTitle')}
      </h3>
      {t('index.features2.contentDesc')}
    </Fragment>
  </Content>

  <Steps
    id="system"
    tagline={t('index.steps.tagline')}
    title={t('index.steps.title')}
    subtitle={t('index.steps.subtitle')}
    isReversed={true}
    items={t('index.steps.items')}
    image={{
      src: 'https://images.unsplash.com/photo-1616198814651-e71f960c3180?ixlib=rb-4.0.3&auto=format&fit=crop&w=987&q=80',
      alt: 'Steps image',
    }}
  />

<EChart
  id="backtest"
  tagline={t('index.chart.tagline')}
  title={t('index.chart.title')}
  subtitle={t('index.chart.subtitle')}
  height="400px"
  csvPath="./src/data/strategy.csv" 
  callToAction={{
      target: '_self',
      text: t('index.chart.btnText'),
      href: `/${lang}/privacy`,
      icon: 'tabler:chevron-right',
    }}
>
  <Fragment slot="content">
    {t('index.features2.contentDesc')}
  </Fragment>
</EChart>

  <Testimonials
    id="testimonials"
    tagline={t('index.testimonials.tagline')}
    title={t('index.testimonials.title')}
    testimonials={t('index.testimonials.items').map(item => ({
      ...item,
      image: { src: item.image, alt: item.name }
    }))}
    callToAction={{
      target: '_blank',
      text: t('index.testimonials.btnText'),
      href: 'https://github.com/arthelokyo/astrowind',
      icon: 'tabler:external-link',
    }}
  />

  <FAQs
    id="faq"
    title={t('faq.faq.title')}
    subtitle={t('faq.faq.subtitle')}
    tagline={t('faq.faq.tagline')}
    classes={{ container: 'max-w-6xl' }}
    items={selectedFAQItems}
  />

  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: t('index.cta.btnText'),
        href: 'https://github.com/arthelokyo/astrowind',
        target: '_blank',
        icon: 'tabler:chevron-right',
      },
    ]}
  >
    <Fragment slot="title">
      {t('index.cta.title')}
    </Fragment>
    <Fragment slot="subtitle">
      {t('index.cta.subtitle')}
    </Fragment>
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </CallToAction>

</Layout>
