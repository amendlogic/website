---
import { getI18nPaths, DEFAULT_LANG } from '~/i18n/config';
import { SITE } from 'astrowind:config';

// 1. Daten und Navigation importieren
import landingData from '~/i18n/landing.json';
import { getFooterData } from '~/navigation.ts';

// Layout & Widgets
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Note from '~/components/widgets/Note.astro';
import Content from '~/components/widgets/Content.astro';
import Steps from '~/components/widgets/Steps.astro';
import EChart from '~/components/widgets/EChart.astro'; 
import Testimonials from '~/components/widgets/Testimonials.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';

// 2. Pfade generieren (SSOT)
export async function getStaticPaths() {
  return getI18nPaths();
}

// 3. Sprache & Content laden
const { lang } = Astro.params;
const currentLang = (lang || DEFAULT_LANG) as keyof typeof landingData;

// Den Textblock für die aktuelle Sprache aus der JSON holen
const txt = landingData[currentLang];

// 4. Footer zusammenbauen
const baseFooterData = getFooterData(currentLang);
const homeFooterData = {
  ...baseFooterData,
  disclaimer: txt.footerDisclaimer
};

// 5. Metadaten
const metadata = {
  title: 'AstroWind — Free template for creating websites with Astro + Tailwind CSS',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata} footerData={homeFooterData}>
  
  <Hero 
    image={{ src: '~/assets/images/hero-image.png', alt: 'AstroWind Hero Image' }}
  >
    <Fragment slot="actions">
      <a href="https://github.com/arthelokyo/astrowind" target="_blank" class="btn btn-primary inline-flex items-center gap-2">
        {txt.hero.btnPrimary}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 1 59 59" class="w-10 h-10 ml-1 -mr-1.5 rtl:mr-1 rtl:-ml-1.5 inline-block">
          <path d="M33 17c-3.5 0-6.3 2.85-6.35 6.35 0 3.5 2.85 6.35 6.35 6.35s6.35-2.85 6.35-6.35S36.5 17 33 17ZM45.7 45.5 57.6 17H44.95L33.05 45.5H45.7Zm-22.25 0V17H1.3V28.1H12.4V45.5H23.5Z" fill="#FFFFFF"/>
        </svg>
      </a>
      <a href="#features" class="btn btn-secondary">
        {txt.hero.btnSecondary}
      </a>
    </Fragment>

    <Fragment slot="title">
      {txt.hero.titleStart}
      <span class="text-accent dark:text-white"> {txt.hero.titleAccent}</span>. {txt.hero.titleEnd}
    </Fragment>

    <Fragment slot="subtitle">
        <span class="block mb-1 font-bold text-blue-600">{txt.hero.tagline}</span>
        <span class="font-semibold">{SITE?.name}</span> {txt.hero.subtitle}
    </Fragment>
  </Hero>

  <Note title={txt.note.title} description={txt.note.desc} />

  <Content
    isReversed
    id="features"
    tagline={txt.features1.tagline}
    title={txt.features1.title}
    items={txt.features1.items}
    image={{
      src: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80',
      alt: 'Colorful Image',
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">{txt.features1.contentTitle}</h3>
      {txt.features1.contentDesc}
    </Fragment>
  </Content>

  <Content
    isAfterContent
    items={txt.features2.items}
    image={{
      src: 'https://images.unsplash.com/photo-1600132806370-bf17e65e942f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2194&q=80',
      alt: 'Blueprint Image',
    }}
  >
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">{txt.features2.contentTitle}</h3>
      {txt.features2.contentDesc}
    </Fragment>
  </Content>


  <Steps
    tagline={txt.steps.tagline}
    title={txt.steps.title}
    subtitle={txt.steps.subtitle}
    isReversed={true}
    items={txt.steps.items}
    image={{
      src: 'https://images.unsplash.com/photo-1616198814651-e71f960c3180?ixlib=rb-4.0.3&auto=format&fit=crop&w=987&q=80',
      alt: 'Steps image',
    }}
  />

  <EChart
    tagline={txt.chart.tagline}
    title={txt.chart.title}
    subtitle={txt.chart.subtitle}
    height="400px"
    options={{
      tooltip: { trigger: "axis", valueFormatter: v => `${v}%` },
      legend: { data: ["AmendLogic", "Buy & Hold", "Drawdown"] },
      xAxis: { type: "category", data: ["2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024", "2025", "2026"] },
      yAxis: [
        { type: "value", name: "Equity %", position: "left", axisLabel: { formatter: "{value}%" } },
        { type: "value", name: "Drawdown %", position: "right", min: -100, max: 0, axisLabel: { formatter: "{value}%" } }
      ],
      series: [
        { name: "AmendLogic", type: "line", smooth: true, data: [0, 35, 120, 90, 160, 210, 210, 210, 210, 210, 210], lineStyle: { width: 3 } },
        { name: "Buy & Hold", type: "line", smooth: true, data: [0, 20, 95, 40, 110, 180], lineStyle: { type: "dashed" } },
        { name: "Drawdown", type: "bar", yAxisIndex: 1, data: [0, -12, -35, -55, -18, -10, -10, -10, -10, -10, -10], itemStyle: { color: "rgba(239,68,68,0.5)" } }
      ]
    }}
  />

  <Testimonials
    tagline={txt.testimonials.tagline}
    title={txt.testimonials.title}
    testimonials={txt.testimonials.items.map(item => ({
      ...item,
      image: { src: item.image, alt: item.name } // JSON Strings in Astro Images umwandeln
    }))}
    callToAction={{
      target: '_blank',
      text: txt.testimonials.btnText,
      href: 'https://github.com/arthelokyo/astrowind',
      icon: 'tabler:chevron-right',
    }}
  />

  <FAQs
    title={txt.faqs.title}
    subtitle={txt.faqs.subtitle}
    tagline={txt.faqs.tagline}
    classes={{ container: 'max-w-6xl' }}
    items={txt.faqs.items}
  />

  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: txt.cta.btnText,
        href: 'https://github.com/arthelokyo/astrowind',
        target: '_blank',
        icon: 'tabler:download',
      },
    ]}
  >
    <Fragment slot="title">
      <span class="sm:whitespace-nowrap">{txt.cta.titleLine1}&nbsp;</span><br class="block" /><span class="sm:whitespace-nowrap">{txt.cta.titleLine2}</span>
    </Fragment>
    <Fragment slot="subtitle">
      {txt.cta.subtitle}
    </Fragment>
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </CallToAction>

</Layout>