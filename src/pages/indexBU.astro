---
// src/pages/index.astro
export const prerender = true;
---

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redirecting…</title>
  <meta name="robots" content="noindex" />

  <noscript>
    <meta http-equiv="refresh" content="0;url=/de/" />
  </noscript>

  <script is:inline>
    (function () {
      // ======== CONFIG (Nur hier ändern!) ========
      var supported = ['de', 'en'];
      var defaultLang = 'de';
      // ===========================================

      try {
        var target = defaultLang;

        function isSupported(lang) {
          return supported.indexOf(lang) !== -1;
        }

        // ======== 1) COOKIE ========
        // Regex liest nun ALLES aus (bis zum Semikolon), isSupported filtert dann.
        var match = document.cookie.match(/preferred_language=([^;]+)/);
        if (match && match[1] && isSupported(match[1])) {
          target = match[1];
        } else {
          
          // ======== 2) LOCAL STORAGE ========
          var saved = null;
          try { saved = localStorage.getItem("lang"); } catch (e) {}

          if (saved && isSupported(saved)) {
            target = saved;
          } else {
            
            // ======== 3) BROWSER SPRACHE ========
            var browserFull = navigator.language || navigator.userLanguage || "";
            var browserShort = browserFull.split('-')[0].toLowerCase();

            if (isSupported(browserShort)) {
              target = browserShort;
            }
          }
        }

        // ======== 4) REDIRECT ========
        var query = window.location.search || "";
        var hash = window.location.hash || "";

        window.location.replace("/" + target + "/" + query + hash);

      } catch (e) {
        // Fallback nutzt nun auch die Variable
        window.location.replace("/" + defaultLang + "/");
      }
    })();
  </script>
</head>
<body></body>
</html>